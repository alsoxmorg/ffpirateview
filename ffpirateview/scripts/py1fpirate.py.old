#!/usr/bin/env python3
# This is a python script to help with viewing 1f's on
# macosx.
# Requirements: tkinter, pillow
#  brew install python-tk
# linux  apt install python3-tk pillow python3-pil.imaget

print("see comments in code for requirements, tkinter, pillow, pil.imagetk, etc")

import sys
import struct
from tkinter import Tk, Label
from PIL import Image, ImageTk

def load_1ff(filename):
    with open(filename, "rb") as f:
        magic = f.read(8)
        #if magic != b"1bfarbfe":
        if magic.startswith(b'\xef\xbb\xbf'):
            raise ValueError("Not a valid 1ff file")

        width = struct.unpack(">I", f.read(4))[0]
        height = struct.unpack(">I", f.read(4))[0]

        row_bytes = (width + 7) // 8
        bitmap_data = f.read(row_bytes * height)

        img = Image.new("1", (width, height))
        pixels = img.load()

        for y in range(height):
            for x in range(width):
                byte_index = y * row_bytes + (x // 8)
                bit_index = 7 - (x % 8)
                bit = (bitmap_data[byte_index] >> bit_index) & 1
                pixels[x, y] = 255 if bit else 0  # white if 1, black if 0

        return img

def main(filename):
    img = load_1ff(filename)

    root = Tk()
    root.title(filename)
    tk_img = ImageTk.PhotoImage(img)
    label = Label(root, image=tk_img)
    label.pack()
    root.mainloop()

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python3 view1ff.py <file.1ff>")
        sys.exit(1)
    main(sys.argv[1])
